<%- include('../partials/head') %>

<!-- Form container -->
<div class="container margin-top-control-other">
  <div class="card  shadow-lg o-hidden border-0 my-5 register">
    <div class="card-body p-0">
      <div class="row">
        <div class="col-lg-5 d-none d-lg-flex ">
          <div class="flex-grow-1 bg-register-image " style="margin-top:30%;">
            <img src="/images/slider/Image 2.jpg.png" alt="" style="width: 100%;height: 60%;background-size: cover;">
          </div>
        </div>
        <div class="col-lg-7">
          <div class="p-5">
            <div class="text-center">
              <img src="/images/Logo/usercreate.jpg" alt="" style="width: 50px;height: 50px;">
              <h4 class="text mb-4" style="color: #16AF00;font-size: xx-large;">Create an Account!</h4>
            </div>
            <!-- form       -->
            <form action="/register" method="POST"
              onsubmit="if(document.getElementById('agree').checked) { return true; } else { alert('Please indicate that you have read and agree to the Terms and Conditions and Privacy Policy'); return false; }">

              <div class="form-group row">
                <div class="col-sm-12 mb3 mb-sm-0">
                  <% if(Ferror && Ferror.length>0){ %>
                  <div class="alert alert-danger" role="alert">
                    <strong><%=Ferror %></strong>
                  </div>
                  <% } %>
                </div>
              </div>
              <div class="form-group row">
                <div class="col-sm-6">
                  <label for="fullname" class="label-content">First Name</label>
                  <input type="text" class="form-control form-content" placeholder="First Name" name="firstname"
                    id="firstname" required>
                </div>
                <div class="col-sm-6">
                  <label for="fullname" class="label-content">Last Name</label>
                  <input type="text" class="form-control form-content" placeholder="Last Name" name="lastname"
                    id="lastname" required>
                </div>

                <div class="col-sm-12 mb-3">
                  <label for="exampleInputPassword1" class="label-content">Password</label>
                  <input type="password" class="form-control form-content mb-0" id="exampleInputPassword1"
                    name="password" placeholder="Password" pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$"
                    title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters"
                    required>
                  <small class="text-muted">Required Format:</small>
                  <div class="row">
                    <div class="col-sm-6">
                      <small><i class="fa fa-check-circle-o" aria-hidden="true"></i> Atleast One capital
                        character</small>
                    </div>
                    <div class="col-sm-6">
                      <small class=""><i class="fa fa-check-circle-o" aria-hidden="true"></i> Atleast One small
                        character</small>
                    </div>
                    <div class="col-sm-6">
                      <small class=""><i class="fa fa-check-circle-o" aria-hidden="true"></i> Atleast One digit</small>
                    </div>
                    <div class="col-sm-6">
                      <small class=""><i class="fa fa-check-circle-o" aria-hidden="true"></i> Atleast 8 character
                        long</small>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6">
                  <label for="phNumber" class="label-content">Mobile Number</label>
                  <input type="text" class="form-control form-content text-center" placeholder="Contact" name="username"
                    readonly value="<%=phNumber%>" id="phNumber">
                </div>

                <div class="col-sm-6">
                  <label for="inputGroupSelect01" class="label-content">User Type</label>
                  <select class="custom-select form-content" id="userType" name="userType" required>
                    <option selected value="">User Type</option>
                    <option value="donor">Donor</option>
                    <option value="consumer">Consumer</option>
                    <!-- <option value="nodal">Nodal</option> -->
                  </select>
                </div>

              </div>
              <div class="form-group row">
                <div class="col-sm-6">
                  <label for="inputGroupSelect01" class="label-content">Select Gender</label>
                  <select class="custom-select form-content" id="inputGroupSelect01" name="gender" required>
                    <option selected value="">Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="User"> Others</option>
                  </select>
                </div>


                <div class="col-sm-6">
                  <label for="age" class="label-content">Age</label>
                  <input type="text" class="form-control form-content" placeholder="Age" name="age" id="age" required>
                </div>

                <div class="col-sm-6">
                  <label for="inputState" class="label-content"> Your State</label>
                  <select class="custom-select form-content" id="inputState" name="state" required>
                    <option selected value="">State</option>
                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                    <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                    <option value="Assam">Assam</option>
                    <option value="Bihar">Bihar</option>
                    <option value="Chandigarh">Chandigarh</option>
                    <option value="Chhattisgarh">Chhattisgarh</option>
                    <option value="Dadar and Nagar Haveli">Dadar and Nagar Haveli</option>
                    <option value="Daman and Diu">Daman and Diu</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Lakshadweep">Lakshadweep</option>
                    <option value="Puducherry">Puducherry</option>
                    <option value="Goa">Goa</option>
                    <option value="Gujarat">Gujarat</option>
                    <option value="Haryana">Haryana</option>
                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                    <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                    <option value="Jharkhand">Jharkhand</option>
                    <option value="Karnataka">Karnataka</option>
                    <option value="Kerala">Kerala</option>
                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                    <option value="Maharashtra">Maharashtra</option>
                    <option value="Manipur">Manipur</option>
                    <option value="Meghalaya">Meghalaya</option>
                    <option value="Mizoram">Mizoram</option>
                    <option value="Nagaland">Nagaland</option>
                    <option value="Odisha">Odisha</option>
                    <option value="Punjab">Punjab</option>
                    <option value="Rajasthan">Rajasthan</option>
                    <option value="Sikkim">Sikkim</option>
                    <option value="Tamil Nadu">Tamil Nadu</option>
                    <option value="Telangana">Telangana</option>
                    <option value="Tripura">Tripura</option>
                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                    <option value="Uttarakhand">Uttarakhand</option>
                    <option value="West Bengal">West Bengal</option>
                  </select>
                </div>

                <div class="col-sm-6">
                  <label for="inputCity" class="label-content"> Your City</label>
                  <input type="text" class="form-control form-content" placeholder="City" name="city" required
                    id="inputCity">
                </div>


                <div class="row form-group justify-content-center " style="width: 100%;">
                  <div class=" " style="margin-left: 30px;">
                    <label for="exampleFormControlTextarea1" class="label-content"> Full Address</label>
                    <textarea class="form-control form-content" id="exampleFormControlTextarea1" rows="3" cols="70"
                      name="address" required placeholder="Enter address"></textarea>
                  </div>

                </div>

                <input type="text" name="lat" id="nodallat" style="display: none;" readonly>
                <input type="text" name="lon" id="nodallon" style="display: none;" readonly>

                <a class="btn btn-primary btn-block text-white btn-user form-content" data-toggle="modal"
                  data-target="#myModal" id="locModal" style="display:none; width: 50%; margin: auto;"> Choose your
                  location</a>

                <button class="btn btn-primary btn-block text-white btn-user form-content" type="submit"
                  id="regButton">REGISTER
                  NOW</button>


            </form>
            <!-- form ends    -->

            <div class="text-center form-content row justify-content-center" style="width: 100%;">
              <div class="col-sm-6 " style="margin-left: 20px;">
                <input type="checkbox" name="checkbox" value="check" id="agree" /> I have read and agree to the
                <p style="font-size: 14px;"></p><a href="/terms" class="anchor-text"><b>Privacy Policy</b> </a>and
                <a href="/terms" class="anchor-text">Term of Serivces</a> </p>
                <div class="form-content">

                  <a class="small" href="/login">Already have an account?Login!</a>
                </div>
              </div>

            </div>


          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Form Container ends -->


<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog" style="padding-right: -17px;">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content text-center">
      <button type="button" class="close" data-dismiss="modal" style="text-align: right;">&times;</button>
      <div class="modal-body">
        <div id="map" class="map" style="height: 400px;">
          <div class="row">
            <div class="pl-5 pr-5 pt-5 text-center" style="color:#16AF00;">
              Cannot Fetch for Location,
              Please
              check your permissions and refresh your page!</div>
          </div>

        </div>
        <div class="p-2">
          <p id="markerError"></p>
          <div class="form-group justify-content-center">
            <div class="row justify-content-center">
              <div class="col-lg-12 p-0">
                <span style="color: #ff8400; font-size: 20px;"> Note :</span> <br>
                Choose the location you want to choose as your NODAL POINT.<br>
                You cannot change the location in the future.
              </div>
              <button class="btn btn-primary text-white mt-2  submit-edit" type="submit" style="width: 30%;"
                class="close" data-dismiss="modal">&times;
                Continue
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>
</div>

<!-- modal section ends here -->


<script>

  var marker
  var map
  var lat = 0, lon = 0;

  function initMap() {

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition, locError);
      document.getElementById('map').setAttribute("value", "");
    } else {
      locError();
      alert("Your Device does not support geolocation!")
    }

  }

  function locError() {
    $('#regButton').prop('disabled', true);
    alert("Please grant the website permission to access your location!")
  }

  function showPosition(position) {
    lat = position.coords.latitude
    lon = position.coords.longitude;
    console.log(lat, lon);
    if (lat != 0 && lon != 0) {
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 16,
        center: { lat: lat, lng: lon },
      });

      map.addListener('click', function (e) {
        placeMarkerAndPanTo(e.latLng, map);
      });

    }
    else {
      locError();
      alert("Please turn on your Location!")
    }
    $("#nodallat").val(lat);
    $("#nodallon").val(lon)
  }

  function placeMarkerAndPanTo(latLng, map) {
    if (google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng({ lat: lat, lng: lon }), latLng) <= 2500) {
      $('#markerError').text("")
      if (marker) {
        marker.setMap(null)
      }
      marker = new google.maps.Marker({
        position: latLng,
        map: map
      });
      $("#nodallat").val(latLng.lat());
      $("#nodallon").val(latLng.lng());
    }
    else {
      $('#markerError').text("Marker placed Too far, Please select a dropoff location within 2500 meters of current location")
    }
  }

  $('#userType').change(function () {
    cb = $(this);
    if (cb.val() == 'nodal') {
      $('#locModal').show();
    }
    else {
      $('#locModal').hide();
    }
  });
</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC1LD3IxWyKipGblWEyno-glF8JvH_NM4o&callback=initMap&libraries=geometry">
  </script>



<%- include('../partials/tail') %>